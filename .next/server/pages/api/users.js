"use strict";(()=>{var e={};e.id=829,e.ids=[829],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,n){return n in t?t[n]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,n)):"function"==typeof t&&"default"===n?t:void 0}}})},1886:(e,t,n)=>{let s;n.r(t),n.d(t,{config:()=>m,default:()=>A,routeModule:()=>E});var a={};n.r(a),n.d(a,{default:()=>c});var r=n(1802),o=n(7153),i=n(6249);let d=require("mysql2/promise"),l=()=>{if(!s){if(global.mysqlGlobal)return s=global.mysqlGlobal;let e="45.9.2.198",t="root",n="find_my_buddy_db",a="3306",r="true"===process.env.MYSQL_SSL;if(console.log(`Initializing DB connection to ${e}:${a} User: ${t} DB: ${n}`),!e||!t||!n)throw Error("Database configuration missing. Required: host, user, database.");try{let o={host:e,user:t,password:"HOEvPtB0n5PVhCxybWCKaxB6IlARYSBDzOf6idZs4AKikdEbKFXHSVo3ze4J2CoU",database:n,port:parseInt(a),waitForConnections:!0,connectionLimit:5,queueLimit:0,connectTimeout:2e4,enableKeepAlive:!0,keepAliveInitialDelay:0};r&&(o.ssl={rejectUnauthorized:!1}),s=(0,d.createPool)(o),global.mysqlGlobal=s,console.log(`Connected to MySQL at ${e} (SSL: ${r})`)}catch(e){throw console.error("DATABASE_POOL_ERROR:",e.message),e}}return s};async function u(e){let t=`
    CREATE TABLE IF NOT EXISTS users (
      id VARCHAR(255) PRIMARY KEY,
      name VARCHAR(255) NOT NULL,
      email VARCHAR(255) UNIQUE NOT NULL,
      address TEXT NOT NULL,
      phone VARCHAR(50),
      pinCode VARCHAR(10) NOT NULL,
      password VARCHAR(255) NOT NULL,
      status ENUM('pending', 'approved', 'rejected') DEFAULT 'pending',
      role ENUM('admin', 'user') DEFAULT 'user',
      createdAt DATETIME DEFAULT CURRENT_TIMESTAMP
    )
  `;await e.execute(t)}async function c(e,t){try{let n=l();try{await u(n)}catch(e){return t.status(500).json({message:"SQL Table Error",details:e.message,code:e.code})}if("GET"===e.method){let[e]=await n.execute("SELECT * FROM users ORDER BY createdAt DESC");if(0===e.length)return t.status(200).json([{id:"admin-001",name:"System Admin",email:"admin@gmail.com",password:"admin123",role:"admin",status:"approved",pinCode:"000000",address:"Global HQ",createdAt:new Date().toISOString().slice(0,19).replace("T"," ")}]);return t.status(200).json(e)}if("POST"===e.method){let{name:s,email:a,address:r,phone:o,pinCode:i,password:d}=e.body,l="u_"+Math.random().toString(36).substr(2,9),u=new Date().toISOString().slice(0,19).replace("T"," ");return await n.execute("INSERT INTO users (id, name, email, address, phone, pinCode, password, status, role, createdAt) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)",[l,s,a,r,o||null,i,d,"pending","user",u]),t.status(201).json({id:l,name:s,email:a,status:"pending"})}if("PATCH"===e.method){let{id:s}=e.query,{status:a}=e.body;return await n.execute("UPDATE users SET status = ? WHERE id = ?",[a,s]),t.status(200).json({message:"Updated"})}return t.status(405).json({message:"Method Not Allowed"})}catch(e){return console.error("API_HANDLER_CRASH:",e),t.status(500).json({message:"Database Connection Exception",details:e.message,code:e.code||"NO_CODE"})}}let A=(0,i.l)(a,"default"),m=(0,i.l)(a,"config"),E=new r.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/users",pathname:"/api/users",bundlePath:"",filename:""},userland:a})},7153:(e,t)=>{var n;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return n}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(n||(n={}))},1802:(e,t,n)=>{e.exports=n(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var n=t(t.s=1886);module.exports=n})();